# Fork & Join框架

### 背景

Java7 提供的一个用于并行执行任务的框架，是一个把大任务分割成若干个小任务，最终汇总每个小任务结果后得到大任务结果的框架。

跟Executors FurtureTask的关系？

Fork：把大任务切分为若干子任务

Join：合并子任务的执行结果

例如：计算1+2+...+10000，可以分割成10个子任务，每个子任务分别对1000个数进行求和，最终汇总这10个子任务的结果得到最后的结果。

### 工作窃取算法

如果将所有任务放在同一个队列中，则多个线程会竞争一个队列。

如果将所有任务放在不同的队列中，每个队列对应一个线程，这样线程间就没有竞争。

窃取

* 有的线程处理得快，队列很快就空了，则该线程可以窃取别的队列中的任务去执行
* 为了减少队列竞争，使用双端队列，两个线程分别从头和尾获取任务

优缺点：

* 优点：减少线程间的竞争，提高并行计算的能力
* 缺点：消耗更多资源，如多个双端队列；竞争并没有被杜绝，在窃取的时候如果只剩一个任务了，还是会发生竞争



