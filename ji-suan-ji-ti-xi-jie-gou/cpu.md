![](/assets/cpu 缓存模型.jpg)
CPU 执行速度很快，主存的读写交换速度无法跟上 CPU，所以在 CPU 与主存之间加入了高速缓存（L1 Cache，L2 Cache，L3 Cache，性能逐渐降低，空间逐步加大，上级缓存放的是下级缓存的部分数据）。　
# 基于 CPU 高速缓存的读写
## 缓存行
缓存行是高速缓存与内存之间交换数据的最小单位（类似内存与硬盘之间交换数据的最小单位是页）
## 读
1. CPU 首先从高速缓存中获取数据
2. 未获取到时，再从内存中获取数据所在的**_缓存行_**，同时将缓存行缓存到高速缓存中（局部性原理）

## 写
1. CPU 先将数据写入高速缓存的缓存行
2. 再将高速缓存中的缓存行刷到主存中

**_特别注意：CPU 将数据更新到高速缓存后，并不一定立马就将缓存行写回到内存（更详细信息还需查证）_**

```
// 例如
i = i + 1;
```
 　　当线程执行这个语句时，会先从主存当中读取i的值，然后复制数据所在的缓存行到高速缓存当中，然后CPU执行指令对i进行加1操作，然后将数据写入高速缓存，最后将高速缓存中i所在的缓存行最新的值刷新到主存当中。


