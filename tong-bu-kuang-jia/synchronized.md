# synchronized 的实现原理
> synchronized 锁的是一个对象

| 锁的形式|锁定的对象|
|:--|:--|
|普通同步方法|当前实例对象|
|静态同步方法|Class 对象|
|同步代码块|synchronized(参数对象)|

# 如何锁一个对象？
锁的根本原理就是有个状态标识，那么锁对象用的状态标识存储在什么地方？在 Java 对象头中

# Java 对象头
在 JVM 中每个对象都有个“头”
数组对象：JVM 用3个字宽 word 来存对象头
非数组对象：JVM 用2个字宽 word 存对象头

## 32位系统对象头说明（字宽 word 是32bit）
|长度|内容|说明|
|:--|:--|:--|
|1字宽|Mark Word|hashcode 或锁信息等|
|1字宽|Class Metadata Address|到对象类型数据的指针|
|1字宽|Array Length|数组长度（如果是数组的话，否则没有这个字宽）|

## Mark Word 示例（32位系统）

|25bit|4bit|1bit是否是偏向锁|2bit锁标志位|说明|
|:--|:--|:--|:--|:--|
|对象的 hashCode|对象分代年龄|0|01|无锁状态|


|线程 ID(23bit)|Epoch|对象分代年龄|1(是否偏向锁1bit)|01(锁标志位2bit)|偏向锁(说明)|
|:--|:--|:--|:--|:--|


















| | 使用便捷性 | 灵活性 | 可中断的锁 | 超时获取锁 | 互斥/共享 | 阻塞 |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| Synchronized | 隐式获取/释放锁，代码简洁 | 固化，自动执行 | No | No | 只互斥 | 阻塞 |
| Lock | 显示获取/释放锁，注意编码技巧 | 灵活，手动控制 | Yes | Yes | 可互斥，可共享 | 可非阻塞 |

可中断的锁：在获取锁的过程中或在同步队列中，可响应中断

超时获取锁：如果线程在超时时间内没有获取到锁，则返回