# 同步控制

## 同步控制

多线程环境下的对共享资源的同步访问控制。

## 基础同步框架

假如我们要做这样一件事，实现对一个共享变量的同步访问控制，应该怎么做？

1. 一个线程要访问共享变量，它如何知道自己是否能访问？
   1. 需要一个变量作为同步状态，如果该变量处于合法状态，则线程可以获取访问权限
   2. 线程在获取/释放访问权限时，需要对同步状态做更新操作，而且这个操作要保证是同步的
2. 如果多个线程都没有获取到访问权限，如何处理这些线程？
   1. 未获取到访问权限的线程，应处于阻塞状态（否则线程就结束了，若要重新计算还得重新用一个线程，效率低）
   2. 需要将多个处于阻塞状态的线程管理起来，放在一个queue里，时机成熟时它们可以继续执行
   3. 对这个queue的操作需要是同步的
3. 线程获取到访问权限后，在执行过程中发现其他条件未满足，该如何处理？
   1. 如果其他条件未满足，应暂时放弃访问权限，让其他线程继续运行，这样可以保证效率
   2. 暂时放弃访问权限的线程该如何被处理？
   3. 暂时放弃访问权限和未获取到访问权限是两种不同的情况，逻辑上暂时放弃访问权限的线程，已经做过一些计算；若多个线程都暂时放弃了访问权限，需要将他们管理起来，放在另一个等待queue中
   4. 暂时放弃访问权限的线程，何时才能继续执行，也即它需要的条件何时会被满足？它又如何知道这些条件被满足了？
   5. 采用通知模式，条件满足后主动通知等待的线程；收到通知后，线程继续执行

通过上面的分析，我们知道实现一个同步访问控制的功能，其实是需要做很多工作的。而同步访问控制功能又是一个很常见的功能，总不能每个人都自己写一套吧，所以有没有一个通用的工具提供这种功能呢？

有，那就是队列同步器AbstractQueuedSynchronizer。AbstractQueuedSynchronizer提供了一个通用的基础同步框架，我们可以基于这个框架来实现自己独特的同步访问控制器。

Lock

Lock与Java线程间通信的关系？

等待通知模型

